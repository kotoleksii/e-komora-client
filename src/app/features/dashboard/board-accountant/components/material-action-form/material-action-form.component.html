<div class="material-action-form-wrapper">
    <form [formGroup]="materialForm" (ngSubmit)="onSubmit()">
        <mat-card class="mat-elevation-z6">
            <mat-toolbar>
                <mat-toolbar-row>
                    <div>
                        <a class="btn-action" mat-icon-button
                           [href]="topic === 'edit'
                            ? 'dashboard/accountant/user/' + userId + '/material/' + materialId + '/details/'
                            : 'dashboard/accountant'">
                            <i class="fa-solid fa-arrow-left"></i>
                        </a>
                    </div>
                    <div>
                        <span class="view-card-title">{{pageTitle}}</span>
                    </div>
                    <div>
                        <button *ngIf="topic !== 'details'; else detailsMenu" class="btn-action" mat-icon-button
                                color="accent"
                                type="submit"
                                [disabled]='!materialForm.valid'>
                            <i class="fa-solid fa-floppy-disk"></i>
                        </button>
                    </div>
                </mat-toolbar-row>
            </mat-toolbar>

            <mat-card-content>
                <div class="qr-code centered" *ngIf="topic === 'details'">
                    <div class="qr-code-container">
                        <qr-code value="{{qrCodeData | async}}"
                                 size="128" errorCorrectionLevel="M">
                        </qr-code>
                    </div>
                </div>
                <div class="row" *ngIf="topic === 'send'">
                    <div [innerHTML]="materialToSendInfo | async"></div>
                </div>
                <hr>
                <br>
                <div class="form-card" *ngIf="topic === 'send' || topic === 'add'">
                    <div class="row" *ngIf="topic === 'send'">
                        <h4 class="subtitle">–û–±–µ—Ä—ñ—Ç—å –æ—Å–æ–±—É, –∫–æ–º—É –ø–µ—Ä–µ–¥–∞—Ç–∏</h4>
                        <div class="down-emoji">üëá</div>
                    </div>
                    <div class="row">
                        <mat-form-field class="form-field" appearance="outline">
                            <mat-label>–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∞ –æ—Å–æ–±–∞</mat-label>
                            <mat-select placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∞ –æ—Å–æ–±–∞" formControlName="userId">
                                <mat-option [value]="''">–Ω–µ –æ–±—Ä–∞–Ω–æ</mat-option>
                                <mat-option *ngFor="let user of users" [value]="user.id">
                                    <span>{{user.id}}. {{user.lastName}}</span>
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="form-card" *ngIf="topic !== 'send'">
                    <div class="row">
                        <mat-form-field class="form-field" appearance="outline">
                            <mat-label>–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è</mat-label>
                            <input matInput id="title" type="text" placeholder="–ù–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è"
                                   formControlName="title"/>
<!--                                        <mat-error *ngIf="f.lastName.invalid">{{errorMsg(f.lastName, '–ü—Ä—ñ–∑–≤–∏—â–µ')}}</mat-error>-->
                        </mat-form-field>
                        <mat-form-field class="form-field" appearance="outline">
                            <mat-label>–Ü–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–∏–π –Ω–æ–º–µ—Ä</mat-label>
                            <input matInput id="inventoryNumber" type="text" placeholder="–Ü–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–∏–π –Ω–æ–º–µ—Ä"
                                   formControlName="inventoryNumber"/>
                        </mat-form-field>
                        <mat-form-field class="form-field" appearance="outline">
                            <mat-label>–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç—É</mat-label>
                            <input matInput [matDatepicker]="picker" formControlName="dateStart">
                            <mat-datepicker-toggle matSuffix [for]="picker">
                                <i class="fa-solid fa-calendar-days"></i>
                            </mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="row">
                        <mat-form-field appearance="outline">
                            <mat-label>–¢–∏–ø</mat-label>
                            <mat-select formControlName="type" required>
                                <mat-option>None</mat-option>
                                <mat-option *ngFor="let type of types"
                                            [value]="type">{{type}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field class="form-field" appearance="outline">
                            <mat-label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</mat-label>
                            <input matInput id="amount" type="number" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å"
                                   formControlName="amount"/>
                        </mat-form-field>
                        <mat-form-field class="form-field" appearance="outline">
                            <mat-label>–¶—ñ–Ω–∞</mat-label>
                            <input matInput id="price" type="number" placeholder="–¶—ñ–Ω–∞"
                                   formControlName="price"/>
                        </mat-form-field>
                    </div>
                </div>
            </mat-card-content>
        </mat-card>
    </form>
</div>

<ng-template #detailsMenu>
    <button mat-icon-button [matMenuTriggerFor]="menuDetails">
        <i class="fa-solid fa-ellipsis-vertical"></i>
    </button>
    <mat-menu #menuDetails="matMenu" [overlapTrigger]="false">
        <a class="menu-item" mat-menu-item href="dashboard/accountant/user/{{userId}}/material/{{materialId}}/edit">
            <i class="fa-solid fa-file-pen"></i><span class="menu-item-text">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</span>
        </a>
        <a class="menu-item" mat-menu-item href="dashboard/accountant/user/{{userId}}/material/{{materialId}}/send">
            <i class="fa-solid fa-file-import"></i><span class="menu-item-text">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</span>
        </a>
        <a class="menu-item" mat-menu-item (click)="deleteMaterial(userId, materialId)">
            <i class="fa-solid fa-trash"></i><span class="menu-item-text">–í–∏–¥–∞–ª–∏—Ç–∏</span>
        </a>
    </mat-menu>
</ng-template>
